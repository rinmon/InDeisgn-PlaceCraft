# InDesign オブジェクト自動配置スクリプト仕様書（最終版）

## 1. 概要
このスクリプトは、Adobe InDesign上で指定フォルダ内のオブジェクト（画像、PDFなど）をアートボードに自動配置するツールです。ユーザーはフォルダ、ファイルタイプ、配置サイズ、配置数、配置方法、配置スタイル（グリッドまたはランダム）、グリッド設定、配置順を指定可能で、プレビュー機能により配置前にレイアウトを確認できます。直感的なUIとアイコンを活用し、デザイナーの作業効率を最大化します。

## 2. 機能要件

### 2.1 フォルダ選択

**機能**：オブジェクトが格納されたフォルダを選択。

**詳細**：
- フォルダ選択ダイアログを表示。
- 選択フォルダ内のファイルを対象（ファイルタイプ選択に応じる）。
- アイコン：📁（フォルダ選択ボタン横）。

**エラーハンドリング**：
- フォルダ未選択時：「フォルダを選択してください」アラート。

### 2.2 ファイルタイプ選択

**機能**：取り込むファイルタイプを「全て」または「特定タイプ」から選択。

**詳細**：
- 全て：InDesign対応形式（JPEG, PNG, TIFF, PDFなど）。
- 特定タイプ：ドロップダウンリストで複数選択（例：JPEG, PNG）。
- デフォルト：全て。
- アイコン：📄（ファイルタイプ選択ラベル横）。

**エラーハンドリング**：
- 特定タイプ選択時に未選択：「少なくとも1つのファイルタイプを選択してください」アラート。

### 2.3 配置サイズオプション

**機能**：配置サイズを「原寸」または「アートボードにフィット」から選択。

**詳細**：
- 原寸：オブジェクトを元のサイズで配置。
- アートボードにフィット：アートボードの幅または高さにスケール（アスペクト比保持）。
- ラジオボタンで選択。
- アイコン：📏（原寸）、🔲（フィット）。

### 2.4 配置オブジェクト数の制限

**機能**：配置するオブジェクトの最大数を指定（負荷軽減用）。

**詳細**：
- 数値入力（0～9999、整数）。
- 0：無制限。
- デフォルト：100。
- アイコン：🔢（入力フィールド横）。

**エラーハンドリング**：
- 無効な入力：「0以上の整数を入力してください」アラート。

### 2.5 配置方法

**機能**：オブジェクトを「リアル挿入」または「リンク」で配置。

**詳細**：
- リアル挿入：ドキュメントに埋め込み。
- リンク：外部ファイルへのリンク（変更反映）。
- ラジオボタンで選択。
- アイコン：🖼️（リアル挿入）、🔗（リンク）。

### 2.6 配置スタイル

**機能**：配置スタイルを「グリッド」または「ランダム」から選択。

**詳細**：
- グリッド：整然と配置（グリッド設定適用）。
- ランダム：アートボード内でランダム配置。回転（±0～180°）、スケール（50～200%）指定可能。
- ラジオボタンで選択。ランダム時、回転・スケール入力フィールドを表示。
- アイコン：📐（グリッド）、🎲（ランダム）。

**エラーハンドリング**：
- 無効な入力（例：スケール0%）：「有効な範囲を入力してください」アラート。

### 2.7 グリッド設定

**機能**：グリッド配置時の列数と余白を指定。

**詳細**：
- 列数：1～10（デフォルト3）。
- 余白：0～100mm（デフォルト10mm）。
- グリッド選択時のみ有効。
- アイコン：📐（グリッド設定ラベル横）。

**エラーハンドリング**：
- 列数がアートボード幅を超える：「列数が多すぎます」アラート。

### 2.8 配置順

**機能**：配置順を指定（ファイル名、ファイルサイズ、作成日、ランダム）。

**詳細**：
- ドロップダウンリストで選択。
- デフォルト：ファイル名。
- アイコン：🔄（配置順ラベル横）。

### 2.9 配置プレビュー

**機能**：配置前にアートボード上での配置をプレビュー。

**詳細**：
- 「プレビュー」ボタンで簡易サムネイル表示（配置位置確認）。
- プレビュー後、「適用」ボタンで配置確定。
- アイコン：👁️（プレビューボタン横）。

**エラーハンドリング**：
- プレビュー生成失敗：「プレビューを生成できませんでした」アラート。

### 2.10 配置ロジック

**機能**：オブジェクトをアートボードに配置。

**詳細**：
- 配置順：指定順（ファイル名、サイズ、作成日、ランダム）。
- グリッド配置：左上から右へ、指定列数・余白で配置。
- ランダム配置：ランダム位置、指定回転・スケール適用。
- はみ出し時：グリッドは次の行へ、ランダムはアートボード内に収まる位置を再計算。
- アートボード不足時：「アートボードが不足しています。続行しますか？」警告。
- ファイルタイプフィルタ適用後、選択タイプのみ配置。
- 非対応ファイルはスキップ。

## 3. ユーザーインターフェース

**形式**：InDesignスクリプトパネルから実行可能なダイアログ。

**構成**：
```
+------------------------------------------+
| 📁 フォルダ選択: [選択ボタン] [パス表示] |
+------------------------------------------+
| 📄 ファイルタイプ                        |
|   ( ) 全て 📂                           |
|   ( ) 特定タイプ 📑 [ドロップダウン]     |
+------------------------------------------+
| 🎲 配置スタイル                          |
|   ( ) グリッド 📐                      |
|       列数: [3]  余白: [10] mm         |
|   ( ) ランダム 🎲                      |
|       回転: [±30]°  スケール: [80-120]% |
+------------------------------------------+
| 🔄 配置順: [ファイル名 ▼]               |
+------------------------------------------+
| 🔲 配置サイズ                            |
|   ( ) 原寸 📏                           |
|   ( ) アートボードにフィット 🔲         |
+------------------------------------------+
| 🔢 配置オブジェクト数: [100] (0=無制限)   |
+------------------------------------------+
| 🔗 配置方法                              |
|   ( ) リアル挿入 🖼️                    |
|   ( ) リンク 🔗                         |
+------------------------------------------+
| [プレビュー] 👁️    [キャンセル]  [OK]   |
+------------------------------------------+
```

**UI動作**：
- ファイルタイプ「特定タイプ」選択時、ドロップダウン有効。
- 配置スタイル「グリッド」時、列数・余白入力表示。
- 配置スタイル「ランダム」時、回転・スケール入力表示。
- プレビューボタンでサムネイルウィンドウ表示。

## 4. 技術要件

**スクリプト言語**：ExtendScript（JavaScriptベース、InDesign対応）。

**対象バージョン**：Adobe InDesign CC 2020以降。

**依存性**：InDesign標準APIのみ。

**パフォーマンス**：
- 1000オブジェクト以上でプログレスバー表示。
- ファイルタイプフィルタリングは正規表現で効率化。
- ランダム配置は重なり最小化アルゴリズム実装。
- プレビューは低解像度で生成。
- 1オブジェクトごとに処理を完結し、メモリ使用量を抑制。

## 5. 動作フロー

1. スクリプト実行、ダイアログ表示。
2. ユーザーがフォルダ、ファイルタイプ、配置スタイル、グリッド設定、配置順、サイズ、配置数、配置方法を指定。
3. 「プレビュー」クリックで配置イメージ確認（任意）。
4. 「OK」クリック後、フォルダ内ファイルを走査（ファイルタイプ・配置順適用）。
5. 指定数までオブジェクトをアートボードに配置（グリッドまたはランダム）。
6. 配置完了：「配置完了：X個のオブジェクトを配置しました」アラート。
7. エラー時、適切なメッセージで処理中断。

## 6. 拡張性

**将来的な追加**：
- カスタムファイルタイプ（AI, EPS）。
- レイヤー指定（特定レイヤーに配置）。
- 配置後の自動整列（中央揃えなど）。
- テンプレート保存（設定の再利用）。

## 7. テスト計画

**テストケース**：
- フォルダ：空、無効、大量ファイル（1000以上）。
- ファイルタイプ：全て、特定（JPEGのみ、複数）。
- 配置スタイル：グリッド（列数1～10、余白0～100mm）、ランダム（回転±180°、スケール50～200%）。
- 配置順：ファイル名、サイズ、作成日、ランダム。
- プレビュー：少量（10）、大量（500）オブジェクト。
- 配置サイズ：原寸（巨大/小画像）、フィット（縦長/横長アートボード）。
- 配置数：0（無制限）、1、1000以上。
- 配置方法：リアル挿入（ファイルサイズ確認）、リンク（リンクパネル確認）。

**環境**：InDesign 2023、2025（Windows/Mac）。

## 8. 注意点

- 大量配置時の負荷軽減のため、プログレスバー必須。
- 非対応ファイルはスキップ（ログ保存なし）。
- アートボード不存在時：「アートボードを作成してください」アラート。
- ランダム配置時のオブジェクト重なりは最小限に抑える。
- プレビュー生成は高速化優先（低解像度サムネイル）。
